{% extends "base.html" %}

{% block head_title %}
{% trans %}Sign up{% endtrans %}
{% endblock %}

{% block content %}
{% if errors %}
<div class="alert alert-danger col-md-4 col-md-offset-4">
  {% if errors|count == 1 %}
    {{ errors|first }}
  {% else %}
    <ul>
    {% for error in errors %}
      <li>{{ error }}</li>
    {% endfor %}
    </ul>
  {% endif %}
</div>
{% else %}
<div class="row offset-bottom">
  <div class="col-md-4 col-md-offset-4">
    <form class="form-horizontal" role="form" id="form-signup" action="{% url auth-custom-sign-up-invoke %}" method="post">
      <legend>Finish sign up</legend>
      <span class="help-block">{% trans %}Just one step to create your account{% endtrans %}</span>

      {% csrf_token %}
      <input type="hidden" name="email" value="{{ email }}">
      <input type="hidden" name="confirmation_key" value="{{ confirmation_key }}">

      <div class="offset-bottom">
        <div class="input-group">
          <span class="input-group-addon"><span class="glyphicon glyphicon-pencil"></span></span>
          <input type="text" class="form-control" name="first_name" data-toggle="tooltip" title="{{ form.first_name.help_text }}" placeholder="{{ form.first_name.label }}" required>
        </div>
      </div>
      <div class="offset-bottom">
        <div class="input-group">
          <span class="input-group-addon"><span class="glyphicon glyphicon-pencil"></span></span>
          <input type="text" class="form-control" name="last_name" data-toggle="tooltip" title="{{ form.last_name.help_text }}" placeholder="{{ form.last_name.label }}">
        </div>
      </div>
      <div class="offset-bottom">
        <div class="input-group">
          <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
          <input type="text" class="form-control" name="username" data-toggle="tooltip" title="{{ form.username.help_text }}" placeholder="{{ form.username.label }}" required>
        </div>
      </div>
      <div class="offset-bottom">
        <div class="input-group">
          <span class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
          <input type="password" class="form-control" name="password" data-toggle="tooltip" title="{{ form.password.help_text }}" placeholder="{{ form.password.label }}" required>
        </div>
      </div>
      <div class="form-group">
        <label class="col-sm-4 control-label">{% trans %}Email{% endtrans %}</label>
        <div class="col-sm-8">
          <p class="form-control-static">{{ email }}</p>
        </div>
      </div>
      <div class="form-group">
        <label for="select_language" class="col-sm-4 control-label">{{ form.language.label }}</label>
        <div class="col-sm-6">
          <select class="form-control" id="signup_language" name="language" data-toggle="tooltip" title="{{ form.language.help_text }}">
          {% for code, (name, native) in form.language.field.choices %}
            <option title="{{ name }}" value="{{ code }}" title="{{ name }}"{% if code == LANGUAGE_CODE %} selected='selected'{% endif %}>{{ native }}</option>
          {% endfor %}
          </select>
        </div>
      </div>
      <div class="form-group">
        <div class="col-sm-8 col-sm-offset-4">
          <label class="checkbox">
            <input type="checkbox" name="remember_me">
            {{ form.remember_me.label }}
          </label>
        </div>
      </div>
      <button id="submit-signup" type="submit" class="btn btn-success btn-lg btn-block ladda-button" data-style="zoom-out">{% trans %}Join right now{% endtrans %}!</button>
    </form>
  </div>
</div>
{% endif %}
{% endblock %}


{% block script_extras %}
<script type="text/javascript">
  /* Submit sign up data */
  $('#form-signup').submit(function(e) {
    e.preventDefault()
    var frm = $(this)
    , url = frm.attr('action')
    , button = frm.find('#submit-signup').get(0)

    if (typeof button.ladda === "undefined") {
      button.ladda = Ladda.create(button)
    }

    button.ladda.start()
    $.post(url
      , frm.serialize()
      , function(response) {
        if (response.status == 'success') {
          // TODO:
        } else {
          // TODO:
        }
      }
      , "json"
    ).fail(function(request, status, error) {
      // TODO:
    }).always(function(data) {
      button.ladda.stop()
    })

    return false
  })
</script>
{% endblock %}
